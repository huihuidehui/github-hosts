from time import sleep
from typing import List
from loguru import logger
import requests


class AliPing:
    def __init__(self):
        pass

    def _create_task(self,host:str) -> str:
        url = "https://boce.aliyun.com/data/api.json?action=BatchCreateOnceSiteMonitor"
        payload = f"csrf_token=mock-sec-token&_csrf=mock-sec-token&sec_token=mock-sec-token&product=metrics20180308&action=BatchCreateOnceSiteMonitor&params=%7B%0A%20%20%20%20%22TaskList.1.TaskType%22%3A%20%222%22%2C%0A%20%20%20%20%22TaskList.1.TaskName%22%3A%20%22a144f4c6_4d685db18d24fdc166%22%2C%0A%20%20%20%20%22TaskList.1.Address%22%3A%20%22{host}%22%2C%0A%20%20%20%20%22TaskList.1.Interval%22%3A%200%2C%0A%20%20%20%20%22TaskList.1.IspCity%22%3A%20%5B%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2259%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218877%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218758%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221226%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22849%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22375%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22273%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221213%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22128%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22812%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22601%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22820%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221199%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%22465%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22576%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221193%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22823%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218818%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218843%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218747%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221220%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218827%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221201%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218840%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218854%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218829%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221204%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218829%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22813%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218852%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218816%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218805%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22812%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218870%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221215%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221213%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218833%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221201%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218866%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22375%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218805%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221204%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221213%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218836%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218872%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22409%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22459%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22375%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218844%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218843%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218818%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22828%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218830%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218859%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218839%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221209%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22813%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218836%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2222%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218792%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218833%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221226%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218846%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218852%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218827%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221226%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218840%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218835%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221213%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218836%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221201%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22459%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218850%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218805%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221220%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22620%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218824%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218747%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218868%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22375%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218856%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22839%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22819%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221204%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218858%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218863%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218825%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221193%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218839%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%221193%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218857%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%22820%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22isp%22%3A%20%2218828%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22city%22%3A%20%2218839%22%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%5D%2C%0A%20%20%20%20%22TaskList.1.Options%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%22time_out%22%3A%2030000%2C%0A%20%20%20%20%20%20%20%20%22enable_operator_dns%22%3A%20true%2C%0A%20%20%20%20%20%20%20%20%22count%22%3A%205%2C%0A%20%20%20%20%20%20%20%20%22ping_num%22%3A%2010%0A%20%20%20%20%7D%0A%7D&umid=mock-umid&collina=mock-collina-ua"
        headers = {
            "authority": "boce.aliyun.com",
            "accept": "*/*",
            "accept-language": "zh-CN,zh;q=0.9",
            "bx-v": "2.5.10",
            "cache-control": "no-cache",
            "content-type": "application/x-www-form-urlencoded",
            "cookie": "XSRF-TOKEN=972c4a12-968c-49b3-84b9-0a52dfbc5e22; ",
            "dnt": "1",
            "origin": "https://boce.aliyun.com",
            "pragma": "no-cache",
            "referer": "https://boce.aliyun.com/detect/ping",
            "sec-ch-ua": '"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"',
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": '"macOS"',
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "same-origin",
            "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
            "x-xsrf-token": "972c4a12-968c-49b3-84b9-0a52dfbc5e22",
        }

        response = requests.request("POST", url, headers=headers, data=payload)
        if response.json().get("code") != "200":
            raise Exception(f"ali ping create task error, {response.text}")
        task_id = response.json().get("data").get("Data")[0].get("taskId")
        return task_id

    def get_all_ip(self, host: str) -> List[str]:

        task_id = self._create_task(host)
        logger.info(f"success create task, task id is {task_id}")
        logger.info(f"sleep 10s for task run")
        sleep(10)
        url = "https://boce.aliyun.com/data/api.json?action=DescribeMetricEventList"

        payload = f"csrf_token=mock-sec-token&_csrf=mock-sec-token&sec_token=mock-sec-token&product=metrics20190101&action=DescribeMetricEventList&params=%7B%22Dimensions%22%3A%5B%7B%22taskId%22%3A%22{task_id}%22%7D%5D%2C%22Namespace%22%3A%22acs_networkmonitor%22%2C%22EventName%22%3A%22ProbeLog%22%2C%22Length%22%3A5000%7D&umid=mock-umid&collina=mock-collina-ua"
        headers = {
            "authority": "boce.aliyun.com",
            "accept": "*/*",
            "accept-language": "zh-CN,zh;q=0.9",
            "bx-v": "2.5.10",
            "cache-control": "no-cache",
            "content-type": "application/x-www-form-urlencoded",
            "cookie": "cna=HYYOHkIpOVQCAXD5dROKk3e2; XSRF-TOKEN=972c4a12-968c-49b3-84b9-0a52dfbc5e93; tfstk=eKRpjPa2aVUK_uEVIXHMa5C-YxgMJBLFXH8bZgj3FhK92hRHKUMEybLHkTXSY6AJXn-YZpmFqhLWxhxH2UuFPgtW2gvnIjYe8_5SmghmieuuL9JSmfT46S1PNmmgI76EM_-A1QPVc-GnzknUiIAlRx1J-jYguW_5piTt3WP3b6EcxesTN7sd79UkRGF7NCsr9IAxNkEcDa2IWVezU9_NBUBqHBav0N7Om2h8U8WZ7NImWmwzU9_NWi0Km8yPQV5..; isg=BAsLU-kW6nnNPDYlM5GSBCmLmqn1oB8iueNJVH0QxcqGnCX-DnI0cgBydpxyvHca",
            "dnt": "1",
            "origin": "https://boce.aliyun.com",
            "pragma": "no-cache",
            "referer": "https://boce.aliyun.com/detect/ping",
            "sec-ch-ua": '"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"',
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": '"macOS"',
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "same-origin",
            "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
            "x-xsrf-token": "972c4a12-968c-49b3-84b9-0a52dfbc5e93",
        }

        response = requests.request("POST", url, headers=headers, data=payload)

        ips = []
        data_points = response.json().get('data').get("Datapoints")
        for data_point in data_points:
            target_ip = data_point.get('targetIp')
            ips.append(target_ip)
        
        return ips

if __name__ == "__main__":
    ali_ping = AliPing()       
    print(ali_ping.get_all_ip('github.com'))
